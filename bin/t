#!/bin/bash -eu

set -o pipefail

if ! command -v task &> /dev/null; then
  echo >&2 "Install taskwarrior!"
  exit 1
fi


if [[ -z ${PROJECT-} ]]; then
  if git remote get-url origin &> /dev/null; then
    remote_url=$(git remote get-url origin | awk -F':' '{print tolower($NF)}' | sed 's/.git//g')
    REPO=$(echo "$remote_url" | awk -F'/' '{print $NF}' | tr -d '-' | tr -d '0-9')
    PROJECT="${REPO}"
  fi
fi

if [[ -n ${PROJECT-} ]]; then
  task project:"${PROJECT}" "$@"
else
  task "$@"
fi
