#!/bin/bash

set -eu
set -o pipefail

git fetch --all --prune

gone_branches=$(git for-each-ref --format '%(refname) %(upstream:track)' refs/heads |\
  awk '$2 == "[gone]" {sub("refs/heads/", "", $1) ; print $1}')

for branch in $gone_branches; do
  git branch -D "$branch"
done

git gc --aggressive
