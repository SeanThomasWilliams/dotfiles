#!/bin/bash

set -e

DIR="$(cd "$(dirname "$0")" && pwd)"

cd "$DIR"

git submodule update --init --recursive

for fname in "$DIR"/.*; do
    if [[ -f $fname ]]; then
        fname="$(basename "$fname")"
        ln -sf "$DIR/$fname" "$HOME/$fname"
    fi
done

# Bash-completion
set -x
mkdir -p "$HOME/.local/share/"
rm -f "$HOME/.local/share/bash-completion"
ln -sf "$DIR/.local/share/bash-completion" "$HOME/.local/share/"

# For neovim
mkdir -p "$HOME"/.config
rm -f "$HOME"/.config/nvim
ln -sf "$DIR"/vim "$HOME"/.config/nvim
ln -sf "$DIR"/.vimrc "$HOME"/.config/nvim/init.vim

mkdir -p "$HOME"/bin
ln -sf "$DIR"/bin/* "$HOME"/bin/
rm -f "$HOME"/.vim
ln -sf "$DIR"/vim "$HOME"/.vim

pip install neovim

echo "Installing bundles"
vim +BundleInstall! +qall
echo "Installing GO binaries"
vim +GoInstallBinaries +qall
vim +UpdateRemotePlugins +qall

echo "Done!"
